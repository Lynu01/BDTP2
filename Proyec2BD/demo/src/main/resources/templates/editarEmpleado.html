<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Editar Empleado</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f6fa;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container { width: 100%; max-width: 600px; }
        h1 { text-align: center; color: #333; }
        form {
            background: #ffffff;
            padding: 25px 40px;
            border-radius: 10px;
            box-shadow: 0px 0px 15px rgba(0,0,0,0.1);
        }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input[type="text"], input[type="date"], input[type="number"], select {
            width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box;
        }
        input[readonly] { background-color: #e9ecef; cursor: not-allowed; }
        button {
            background-color: #27ae60; color: white; padding: 12px 20px; border: none; border-radius: 5px;
            cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px;
        }
        button:hover { background-color: #219150; }
        a { display: block; text-align: center; margin-top: 20px; color: #27ae60; text-decoration: none; font-weight: bold; }

        .error-message {
            color: #D8000C; background-color: #FFD2D2; border: 1px solid #D8000C; border-radius: 8px;
            padding: 10px; text-align: center; margin-bottom: 20px;
        }
        .success-message {
            color: #155724; background-color: #D4EDDA; border: 1px solid #C3E6CB; border-radius: 8px;
            padding: 10px; text-align: center; margin-bottom: 20px;
        }
        .hint { font-size: 12px; color: #666; margin-top: 6px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Editar Empleado</h1>

    <form th:action="@{/empleados/actualizar}" method="post">

        <!-- ===== Banners por Flash Attributes ===== -->
        <div th:if="${success}" class="success-message" th:text="${success}">Actualización exitosa.</div>
        <div th:if="${error}" class="error-message" th:text="${error}">Ocurrió un error.</div>

        <!-- ===== Fallback por ?error=XXXX (param.error es lista) ===== -->
        <div th:if="${param.error}" class="error-message" th:switch="${param.error[0]}">
            <div th:case="'50006'">Error: La nueva cédula ya pertenece a otro empleado.</div>
            <div th:case="'50007'">Error: El nuevo nombre ya pertenece a otro empleado.</div>
            <div th:case="'50009'">Error: Nombre inválido. Solo letras (con acentos), espacios y guion medio.</div>
            <div th:case="'50010'">Error: La cédula debe ser solo numérica.</div>
            <div th:case="'50008'">Error general de la base de datos. Intente de nuevo.</div>
            <div th:case="*">Error desconocido.</div>
        </div>

        <!-- ===== Hidden necesarios para el SP ===== -->
        <input type="hidden" name="id" th:value="${empleado.id}" />
        <input type="hidden" name="valorDocumentoIdentidadOriginal" th:value="${empleado.valorDocumentoIdentidad}" />

        <!-- ===== Campos editables ===== -->
        <div class="form-group">
            <label for="nombre">Nombre:</label>
            <!-- SIN pattern: deja que la base responda 50009 y trace -->
            <input
                type="text"
                id="nombre"
                name="nombre"
                th:value="${empleado.nombre}"
                required
                maxlength="100"
            />
        </div>

        <div class="form-group">
            <label for="valorDocumentoIdentidad">Valor Documento Identidad (Cédula):</label>
            <!-- SIN pattern ni inputmode bloqueante: deja que la base responda 50010 y trace -->
            <input
                type="text"
                id="valorDocumentoIdentidad"
                name="valorDocumentoIdentidad"
                th:value="${empleado.valorDocumentoIdentidad}"
                required
                maxlength="30"
            />
        </div>

        <div class="form-group">
            <label for="puesto">Puesto:</label>
            <select id="puesto" name="idPuesto" required>
                <option th:each="puesto : ${puestos}"
                        th:value="${puesto.id}"
                        th:text="${puesto.nombre}"
                        th:selected="${empleado.puesto.id == puesto.id}">
                </option>
            </select>
        </div>

        <!-- ===== Campos de solo lectura ===== -->
        <div class="form-group">
            <label for="fechaContratacion">Fecha Contratación (No editable):</label>
            <input type="date" id="fechaContratacion" name="fechaContratacion"
                   th:value="${empleado.fechaContratacion}" readonly/>
        </div>

        <div class="form-group">
            <label for="saldoVacaciones">Saldo Vacaciones (No editable):</label>
            <input type="number" step="0.01" id="saldoVacaciones" name="saldoVacaciones"
                   th:value="${empleado.saldoVacaciones}" readonly/>
        </div>

        <div>
            <button type="submit">Actualizar</button>
        </div>
    </form>

    <a th:href="@{/empleados/editar/{id}/cancelar(id=${empleado.id})}">
        Volver a la lista de empleados
    </a>
</div>
</body>
</html>
